@model CrowdSisters.Models.Proyecto

@{
    ViewData["Title"] = Model.Titulo;
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{
    // Calcular el porcentaje de la recaudación con respecto al objetivo
    var porcentajeRecaudacion = (int)Math.Ceiling((Model.MontoRecaudado / (decimal)Model.MontoObjetivo) * 100);
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <link rel="stylesheet" href="/css/global.css" />
    <link rel="stylesheet" href="/css/InfoProyecto.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,400;0,500;0,600;0,700;1,300&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&display=swap" />
</head>
<body>
    <div class="infoproyecto">
        <img class="foto1-icon" loading="lazy" alt="" src="@Model.UrlFotoEncabezado" />

        <div class="progress-bar-container">
            <div class="lineaenteraprogreso"></div>
        </div>
        <div class="lineaverdeprogreso" style="width: @porcentajeRecaudacion%;"></div>

        <main class="project-details-container">
            <section class="project-title-container">
                <div class="project-subtitles-container-wrapper">
                    <div class="project-subtitles-container">
                        <div class="project-title-wrapper">
                            <div class="project-title-block-wrapper">
                                <div class="project-title-block">
                                    <div class="project-title-area">
                                        <div class="ttuloproyecto1">
                                            <b class="ttulo33">@Model.Titulo</b>
                                        </div>
                                    </div>
                                    <div class="subtituloproyecto">
                                        <b class="ttulo34">@Model.Subtitulo</b>
                                    </div>
                                </div>
                            </div>
                            <div class="project-stats-container">
                                <div class="project-stats-values-wrapper">
                                    <div class="project-stats-values">
                                        <div class="digitosdias">
                                            <div class="digito3">
                                                <div class="digito3-child"></div>
                                                <div class="days-value">@((Model.FechaFinalizacion - DateTime.Now).Days)</div>
                                            </div>
                                        </div>
                                        <div class="digitosrecaudacion">
                                            <div class="backers-icon">
                                                <div class="digito3">
                                                    <div class="digito3-child"></div>
                                                    <div class="days-value">@Model.MontoRecaudado.ToString("C")</div>
                                                </div>
                                            </div>
                                            <div class="impulsoras">DE @Model.MontoObjetivo.ToString("C")</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="project-stats-container-inner">
                                    <div class="project-description-content-parent">
                                        <div class="project-description-content">
                                            <div class="project-description-block">
                                                <div class="project-description-area">
                                                    <div class="das25">DÍAS</div>
                                                </div>
                                                <b class="titulodescripcion1">
                                                    <p class="qu-es-ecobeauty">¿Qué es @Model.Titulo?</p>
                                                </b>
                                            </div>
                                            <div class="descripcion1-wrapper">
                                                <div class="descripcion1">
                                                    <p class="qu-es-ecobeauty">@Model.DescripcionGeneral</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="descripcion1-wrapper">
                                    <div class="descripcion1">
                                        <p class="qu-es-ecobeauty">@Model.DescripcionFinalidad</p>
                                    </div>
                                </div>
                                <div class="foto2-wrapper">
                                    <img class="foto2-icon" loading="lazy" alt="" src="@Model.UrlFoto1" />
                                </div>
                                <div class="project-subtitles-container-inner">
                                    <div class="titulodescripcion2-parent">
                                        <b class="titulodescripcion2">Presupuesto del proyecto</b>
                                        <div class="second-info-content">
                                            <div class="descripcion3">
                                                <p>@Model.DescripcionPresupuesto</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="foto2-wrapper">
                                    <img class="foto2-icon" loading="lazy" alt="" src="@Model.UrlFoto2" />
                                </div>
                                <div class="project-subtitles-container-inner1">
                                    <div class="titulodescripcion3-parent">
                                        <b class="titulodescripcion4">¡Conoce al creador del proyecto!</b>
                                        <div class="descripcion4">
                                            <img class="foto2-icon" loading="lazy" alt="Creador del proyecto" src="@Model.Usuario.URLImagenUsuario" />
                                            <p>@Model.Usuario.Nombre @Model.Usuario.PrimerApellido @Model.Usuario.SegundoApellido</p>
                                            <p>@Model.Usuario.PerfilPublico</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="rewards-title-container">
                                <div class="titulorecompensas">Recompensas</div>
                            </div>
                            <div class="rewards-carousel">
                                @foreach (var recompensa in ViewBag.ListaRecompensas as List<Recompensa>)
                                {
                                    <div class="cardrecompensa1">
                                        <img class="fotorecompensa1-icon" loading="lazy" alt="Recompensa" src="@recompensa.URLImagenRecompensa" />
                                        <div class="frame-parent26">
                                            <div class="titulorecompnesa1-parent">
                                                <div class="titulorecompnesa1">
                                                    <div class="ttulo35">@recompensa.Titulo</div>
                                                </div>
                                                <div class="descripcionrecompnesa1">
                                                    <p>@recompensa.Descripcion</p>
                                                </div>
                                            </div>
                                            <div class="impulsoras1-parent">
                                                <div class="impulsoras1">
                                                    <p>@recompensa.Monto.ToString("C")</p>
                                                </div>
                                            </div>
                                        </div>
                                        @if(@Model.FKUsuario != ViewBag.UsuarioActivo)
                                        {
                                        <!-- Formulario para realizar una donación -->
                                        <form asp-action="Donacion" method="post" class="crearDonacionForm" id="crearDonacionForm_@recompensa.IDRecompensa">
                                            <!-- Campo oculto para enviar el ID de la recompensa -->
                                            <input type="hidden" name="FKRecompensa" value="@recompensa.IDRecompensa" />

                                            <!-- Campo oculto para enviar el ID del proyecto relacionado -->
                                            <input type="hidden" name="FKProyecto" value="@Model.IDProyecto" />

                                            <input type="hidden" name="FKUsuario" value="@Model.FKUsuario" />

                                            <button type="submit" class="submitBtn" data-id="@recompensa.IDRecompensa" class="btn btn-primary">Donar</button>

                                        </form>
                                }
                                    </div>
                                }


                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
    @section Scripts {

        <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Seleccionar todos los botones de donación
                const donateButtons = document.querySelectorAll('.submitBtn');

                donateButtons.forEach(button => {
                    button.addEventListener('click', function (event) {
                        event.preventDefault();

                        // Obtener el id de la recompensa desde el data-id del botón
                        const idRecompensa = button.getAttribute('data-id');

                        Swal.fire({
                            title: '¿Estás seguro de que quieres donar a este proyecto?',
                            text: "¡No podrás revertir esto!",
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonColor: '#9b59b6',
                            cancelButtonColor: '#d33',
                            confirmButtonText: 'Sí, donar',
                            cancelButtonText: 'No, cancelar'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                // Usar el id de la recompensa para seleccionar el formulario correcto
                                document.getElementById(`crearDonacionForm_${idRecompensa}`).submit();
                            }
                        });
                    });
                });
            });
        </script>
    }

</body>
</html>
